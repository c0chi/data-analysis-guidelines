# ðŸ’» Data analysis 001 - Setup

- [Setting up your environment](#setting-up-your-environment)
  - [Install `pweave`](#install-pweave)
  - [Configure Atom](#configure-atom)
  - [Install LaTeX](#install-latex)
- [Organizing your analysis](#organizing-your-analysis)

## Setting up your environment

There are few people who have no need of fiddling when writing analysis code
on the fly. If you aren't one of them, have no fear. The setup set forth in this
document optimizes your environment for interactive development, without having
build and rebuild your output document to check the axis labels on one chart.

### Install `pweave`

"Literate programming" is the process of bundling source code and documentation
into one package in service of legibility. By extension, "literate analysis"
combines analytical code with narrative text in service of legiblity, as well
as transparency and reproducibility.

In the "literate X" nomenclature, code is compiled by "tangling" the combined
source document, and documentation is generated by "weaving." [`pweave` is a
Python library](http://mpastell.com/pweave/) for "weaving" and "tangling" source
files containing text and Python code blocks.

Installation is as simple as:

```
$ pip install pweave
```

`pweave` can be used as both a Python module and a command-line utility. So far,
we've found the CLI to fit most seamlessly into our Make-driven data pipeline.

For more on using `pweave`, head on over to [Data analysis 101](/using-the-toolkit.md).
Still setting up? Read on.

### Configure Atom

At DataMade, we all have our own favorite code editor. When it comes to analysis,
**Atom** plays nicely with `pweave` to create an interactive development environment
that rivals [Jupyter notebooks](https://jupyter.org/) â€“ without the hassle of
illegible diffs and highly customized file conversion steps.

The bad news is that this environment still requires some configuration. The
good news is that one Denver data scientist [wrote an excellent guide](http://protips.maxmasnick.com/literate-python-setup-with-pweave-and-atom)
to that configuration.

There have been a few changes since the original guide was written. So, we've
put together an amended walk through:

1. Install [Atom](http://atom.io/).
2. If you haven't already, [install `virtualenvwrapper`](https://virtualenvwrapper.readthedocs.io/en/latest/install.html#basic-installation).
3. Create or activate the virtualenv you'll use for your project, then

    ```bash
    pip install ipython ipykernel
    python -m ipykernel install --user
    ```
4. Install these Atom packages:
    - [`hydrogen`](https://atom.io/packages/Hydrogen) â€“ provides inline execution of Python code
    - [`language-weave`](https://atom.io/packages/language-weave) â€“ adds Pweave input files to languages recognized by Atom, and provides syntax highlighting
5. Open your Atom preferences. In the left pane, select "Packages", then search for "Hydrogen" and click "Settings".
    - Under "Language Mappings", add `{"Pweave markdown": "Python 3", "Pweave LaTeX": "Python 3"}`. This lets Hydrogen know there are Python code blocks in in `.pmd` and `.ptexw` files.
    - Under "Startup Code", add `{"Python 3": "\nimport matplotlib\n%matplotlib inline"}`. This tells matplotlib figures to appear in the output when you run a code cell.
6. In the left pane of the Preferences window, click the "Open Config Folder" button to open your Atom configuration files.
    - In `styles.less`, add:

    ```less
    // Hydrogen output - font size is too small
    .hydrogen.output-bubble pre {
      font-size: 16px !important;
    }
    // Hydrogen - hack for 2x images
    .hydrogen.output-bubble .bubble-result-container img {
      width: 50% !important
    }
    ```
    - In `keymap.cson`, add:

    ```cson
    '.platform-darwin atom-text-editor':
      'cmd-enter': 'hydrogen:run'
      'shift-enter': 'hydrogen:run-cell'
    ```

7. If you haven't already, activate the virtualenv where you installed `ipython` and `ipykernel`, then open Atom with `atom .`.
    - **You must open Atom from the command line while your virtualenv is activated to use Hydrogen.**Â If you get a "Kernel not found error," this is usually the problem!
8. In Atom, open (or create) a Pweave markdown file, and try creating and running a code cell (that is, all a block of code enclosed between `<<>>=` and `@`) with `shift + enter`.
    - Head on over to [Data analysis 101](/using-the-toolkit.md) for more on writing Pweave input files!


### Install LaTeX

LaTeX is essentially a document formatting markup language. Skip the muss
and fuss and licenses of popular GUI software. You, too, can produce beautiful
documents with only a few inline tags (think HTML) and useful macros (think
templating engines, like Jinja).

Installation is well-trodden ground. Follow the appropriate link for your
operating system:

- [GNU/Linux & Windows](http://www.tug.org/texlive/)
- [OS X](www.tug.org/mactex/)

## Organizing your analysis

Data making and analysis may live in the same repository, or an analysis
repository [may list a data making repository as a submodule](https://github.com/City-Bureau/chicago-lead).

Either way, analysis files should generally be organized as follows:

```
â”œâ”€â”€ README.md - instructions for making your data and analysis
â”œâ”€â”€ raw
â”‚Â Â  â””â”€â”€ raw data
â”œâ”€â”€ documentation
â”‚Â Â  â””â”€â”€ documentation of raw data
â”œâ”€â”€ intermediate
â”‚Â Â  â””â”€â”€ local copies of intermediate generated data, i.e. static source data downloaded from third-party
â”œâ”€â”€ scripts
â”‚Â Â  â””â”€â”€ custom transformation scripts
â”œâ”€â”€ data
â”‚Â Â  â””â”€â”€ generated data
â”œâ”€â”€ analyses
â”‚Â Â  â””â”€â”€ raw and generated analysis files
â”œâ”€â”€ requirements.txt
â””â”€â”€ Makefile
```
